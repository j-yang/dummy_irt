# File:// 协议支持和数据管理说明

## 项目修改概述

本项目已成功修改为支持 `file://` 协议，并移除了 PWA 功能，改用 localStorage + JSON 文件导入导出的方式进行数据管理。

## 主要变更

### 1. PWA 功能移除
- ✅ 移除了 `vite-plugin-pwa` 依赖
- ✅ 删除了 Service Worker 和 PWA manifest 配置
- ✅ 移除了 main.ts 中的 PWA 注册代码

### 2. 数据存储系统升级
- ✅ 将 IndexedDB 替换为 localStorage
- ✅ 保持了所有原有的数据管理功能
- ✅ 添加了 JSON 文件导入导出功能
- ✅ 支持数据备份和恢复

### 3. File:// 协议支持
- ✅ 优化了 Vite 构建配置，使用相对路径
- ✅ 确保所有资源文件都可以通过 file:// 协议正常加载
- ✅ 修复了跨域问题

## 新功能介绍

### 数据导入导出
在项目管理页面的侧边栏中，新增了"数据管理"区域，包含三个按钮：

1. **📁 导出数据** - 将所有项目和研究数据导出为 JSON 文件
2. **📂 导入数据** - 从 JSON 文件导入数据
3. **🗑️ 清空数据** - 清空所有本地数据

### 数据备份文件格式
导出的 JSON 文件包含：
- 所有项目信息
- 所有研究数据
- 应用设置
- 时间戳和版本信息

文件命名格式：`dbl-studies-backup-YYYY-MM-DD.json`

## 使用方法

### 通过 File:// 协议使用
1. 运行 `npm run build` 构建项目
2. 打开 `dist/index.html` 文件
3. 可以直接用浏览器打开，或者双击文件

### 数据分享和备份
1. **导出数据**：点击"导出数据"按钮，下载 JSON 备份文件
2. **分享数据**：将 JSON 文件发送给其他用户
3. **导入数据**：其他用户点击"导入数据"按钮，选择 JSON 文件即可恢复数据

### 项目快捷方式
- 每个项目卡片都有"Download Shortcut"按钮
- 点击后会下载一个 `.url` 快捷方式文件
- 双击快捷方式可直接打开对应的项目流程图

## 技术实现

### LocalStorage 管理器
- 替换了原有的 IndexedDB 系统
- 提供完全兼容的 API 接口
- 支持日期序列化/反序列化
- 包含错误处理和数据验证

### 构建优化
- 使用相对路径 (`base: './'`)
- 优化资源文件输出路径
- 确保 file:// 协议兼容性

### 错误处理
- 完善的错误提示系统
- 数据验证和格式检查
- 用户友好的操作反馈

## 兼容性说明

- ✅ 支持所有现代浏览器
- ✅ 支持 file:// 协议访问
- ✅ 保持原有功能完整性
- ✅ 数据格式向后兼容

## 开发和构建

```bash
# 安装依赖
npm install

# 开发模式
npm run dev

# 构建生产版本
npm run build

# 预览构建结果
npm run preview
```

构建完成后，可以直接用浏览器打开 `dist/index.html` 文件使用。

## 注意事项

1. **数据持久性**：数据存储在浏览器的 localStorage 中，清除浏览器数据会丢失信息
2. **备份重要性**：建议定期使用导出功能备份重要数据
3. **文件大小**：localStorage 有容量限制（通常5-10MB），大量数据时注意备份
4. **浏览器兼容性**：建议使用 Chrome、Firefox、Edge 等现代浏览器

## 故障排除

### 如果遇到加载问题
1. 确保使用现代浏览器
2. 检查浏览器控制台是否有错误信息
3. 尝试清除浏览器缓存后重新加载

### 如果数据丢失
1. 检查是否有之前导出的 JSON 备份文件
2. 使用"导入数据"功能恢复备份
3. 如无备份，需要重新创建项目数据

---

**项目已成功转换为支持 file:// 协议的离线应用，所有功能都已验证可正常工作！**
